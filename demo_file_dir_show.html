<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>æ˜¾ç¤ºæ–‡ä»¶ç›®å½•</title>
<style>
  ul { list-style-type: none; }
</style>
</head>
<body>

<h2>è¯·é€‰æ‹©ä¸€ä¸ªç›®å½•</h2>
<button onclick="chooseDirectory()">é€‰æ‹©ç›®å½•</button>
<ul id="fileList"></ul>

<script>
  async function chooseDirectory() {
    try {
      const directoryHandle = await window.showDirectoryPicker({
        startIn: 'desktop'
      });
      const fileListElement = document.getElementById('fileList');
      fileListElement.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
      await listFiles(directoryHandle, fileListElement);
    } catch (err) {
      console.error('Error choosing directory:', err);
    }
  }

  async function listFiles(dirHandle, ulElement) {
    for await (const entry of dirHandle.values()) {
      const li = document.createElement('li');
      
      if (entry.kind === 'directory') {
        li.textContent = `ðŸ“ ${entry.name}`;
        li.style.cursor = 'pointer';
        li.setAttribute('data-kind', entry.kind);
        li.addEventListener('click', async (e) => {
          if (e.target.getAttribute('data-kind') === 'directory') {
            if (e.target.getAttribute('data-click') !== '1') {
              e.target.setAttribute('data-click', 1);
              const sublist = document.createElement('ul');
              li.appendChild(sublist);
              await listFiles(entry, sublist);
            } else {
              e.target.setAttribute('data-click', 0);
              li.removeChild(li.lastChild);
            }
          }  
        })
      } else {
        li.textContent = `ðŸ“„ ${entry.name}`;
      }
      
      ulElement.appendChild(li);
    }
  }
</script>

</body>
</html>